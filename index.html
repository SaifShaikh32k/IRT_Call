<!DOCTYPE html>
<html>
<head>
  <title>Picker Location</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

<h3>Picker Entry</h3>

User ID<br>
<input id="userId"><br><br>

Location<br>
<input id="location"><br><br>

<p id="msg"></p>

<table border="1">
  <thead>
    <tr>
      <th>Timestamp</th>
      <th>User ID</th>
      <th>Location</th>
      <th>Floor</th>
      <th>Status</th>
      <th>Remark</th>
    </tr>
  </thead>
  <tbody id="history"></tbody>
</table>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxQco974AYwWWRBhUmbWFddbTe3Wnt8Gmg4rcbr_7p9paO63JFd6he4OQPbFzHeFw0MDA/exec";

const userIdEl = document.getElementById("userId");
const locationEl = document.getElementById("location");
const historyEl = document.getElementById("history");
const msg = document.getElementById("msg");

// Enter on Location → submit
locationEl.addEventListener("keydown", e => {
  if (e.key === "Enter") {
    submitData();
  }
});

// Load history when User ID entered
userIdEl.addEventListener("change", loadHistory);

async function submitData() {
  const userId = userIdEl.value.trim();
  const location = locationEl.value.trim();

  if (!userId || !location) return;

  const fd = new FormData();
  fd.append("userId", userId);
  fd.append("location", location);

  await fetch(SCRIPT_URL, { method: "POST", body: fd });

  msg.innerText = "Saved ✔";

  locationEl.value = "";
  locationEl.focus();

  loadHistory();
}

async function loadHistory() {
  const userId = userIdEl.value.trim();
  if (!userId) return;

  const res = await fetch(`${SCRIPT_URL}?userId=${userId}`);
  const data = await res.json();

  historyEl.innerHTML = "";

  data.forEach(r => {
    const tr = document.createElement("tr");
    r.forEach(c => {
      const td = document.createElement("td");
      td.innerText = c;
      tr.appendChild(td);
    });
    historyEl.appendChild(tr);
  });
}
</script>

</body>
</html>

